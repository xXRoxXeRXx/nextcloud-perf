<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nextcloud Performance Tool</title>
    <link rel="icon" type="image/png" href="/static/favicon.png">
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <div class="container">
        <header>
            <div class="lang-toggle" onclick="toggleLanguage()">
                <i class="fas fa-globe"></i> <span id="currentLang">EN</span>
            </div>
            <h1><i class="fas fa-cloud"></i> <span data-i18n="title">Nextcloud Performance Check</span></h1>
            <div class="subtitle" data-i18n="subtitle">System & Network Analysis Tool</div>
        </header>

        <!-- Login Card -->
        <div class="card" id="loginCard">
            <h2><i class="fas fa-sign-in-alt"></i> <span data-i18n="connection_details">Connection Details</span></h2>
            <form onsubmit="event.preventDefault(); startTest();">
                <div class="form-group">
                    <label for="url" data-i18n="label_url">Nextcloud URL</label>
                    <input type="text" id="url" placeholder="https://cloud.example.com" value="https://">
                </div>
                <div class="form-group">
                    <label for="user" data-i18n="label_username">Username</label>
                    <input type="text" id="user" data-i18n-placeholder="placeholder_username"
                        placeholder="Your Username" autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="pass" data-i18n="label_password">Password / App Token</label>
                    <input type="password" id="pass" data-i18n-placeholder="placeholder_password"
                        placeholder="Your Password" autocomplete="current-password">
                </div>
                <button type="submit" class="btn-primary">
                    <i class="fas fa-tachometer-alt"></i> <span data-i18n="btn_start">Start Benchmark</span>
                </button>
            </form>
        </div>

        <!-- Testing UI -->
        <div class="card" id="progressCard" style="display: none;">
            <!-- New Stepper UI -->
            <div class="progress-stages">
                <div class="stage" id="stage-system">
                    <div class="stage-icon"><i class="fas fa-desktop"></i></div>
                    <span data-i18n="stage_system">System</span>
                </div>
                <div class="stage" id="stage-network">
                    <div class="stage-icon"><i class="fas fa-network-wired"></i></div>
                    <span data-i18n="stage_network">Network</span>
                </div>
                <div class="stage" id="stage-connect">
                    <div class="stage-icon"><i class="fas fa-plug"></i></div>
                    <span data-i18n="stage_connect">Connect</span>
                </div>
                <div class="stage" id="stage-benchmark">
                    <div class="stage-icon"><i class="fas fa-tachometer-alt"></i></div>
                    <span data-i18n="stage_benchmark">Benchmark</span>
                </div>
                <div class="stage" id="stage-report">
                    <div class="stage-icon"><i class="fas fa-file-alt"></i></div>
                    <span data-i18n="stage_report">Report</span>
                </div>
            </div>

            <!-- Large Percentage HUD -->
            <div class="percentage-display">
                <span id="progressPercentage">0%</span>
                <div class="percentage-label" data-i18n="test_running">Test in Progress</div>
            </div>

            <!-- Progress Bar -->
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar" style="width: 0%"></div>
            </div>

            <!-- Current Status -->
            <div class="current-status" style="margin-top: 20px;">
                <div class="spinner"></div>
                <span id="currentStatus" data-i18n="status_initializing">Initializing...</span>
            </div>

            <div style="text-align: center; margin: 20px 0;">
                <button id="cancelBtn" class="btn-secondary" onclick="cancelTest()"
                    style="background: #fff5f5; color: #c0392b; border: 1px solid #fed7d7; padding: 10px 25px; font-size: 0.9em; border-radius: 10px; cursor: pointer;">
                    <i class="fas fa-times-circle"></i> <span data-i18n="btn_cancel">Cancel Test</span>
                </button>
            </div>

            <!-- Collapsible Logs -->
            <details style="margin-top: 20px;">
                <summary style="cursor: pointer; color: #666; font-size: 0.85em; text-align: center;"
                    data-i18n="summary_view_logs">View Technical Logs</summary>
                <div class="log-output" id="log"
                    style="display: block; margin-top: 10px; background: #1e1e1e; color: #00ff00; padding: 15px; border-radius: 8px; font-family: 'Courier New', monospace; max-height: 200px; overflow-y: auto; font-size: 0.8em;">
                </div>
            </details>
        </div>

        <!-- Results Card -->
        <div id="resultsCard" class="card" style="display: none; background: #f8f9fa;">
            <div id="resultHeader" style="text-align: center; margin-bottom: 30px; color: white;">
                <i class="fas fa-check-circle" style="font-size: 60px; margin-bottom: 15px;"></i>
                <h2 style="margin: 0; font-size: 2em;" data-i18n="benchmark_completed">Benchmark Completed!</h2>
            </div>

            <!-- Category 0: Server Information -->
            <div class="dashboard-section">
                <h3 data-i18n="section_server_info"><i class="fas fa-server"></i> Server Information</h3>
                <div class="dashboard-grid">
                    <div class="premium-card">
                        <div class="metric-label" data-i18n="label_url">Target URL</div>
                        <div style="font-weight: bold; font-size: 1em; color: #003d8f; word-break: break-all;"
                            id="resURL">--</div>
                    </div>
                    <div class="premium-card">
                        <div class="metric-label" data-i18n="label_version">Software Version</div>
                        <div style="font-weight: bold; font-size: 1.1em; color: #003d8f;" id="ncStatusDetail">Nextcloud
                            --</div>
                        <div style="margin-top: 10px; display: none;" id="ncStatusBadge" class="badge"></div>
                    </div>
                </div>
            </div>

            <!-- Category 1: Environment HUD -->
            <div class="dashboard-section">
                <h3 data-i18n="section_system_info"><i class="fas fa-desktop"></i> System Information</h3>
                <div class="dashboard-grid">
                    <div class="premium-card">
                        <div class="metric-label" data-i18n="label_client_os">Client OS</div>
                        <div style="font-weight: bold; font-size: 1.1em; color: #003d8f;" id="sysOS">--</div>
                    </div>
                    <div class="premium-card">
                        <div class="metric-label" data-i18n="label_cpu_model">CPU Model</div>
                        <div style="font-weight: bold; color: #333;" id="sysCPU">--</div>
                        <div style="margin-top: 5px; font-size: 0.9em; color: #666;">
                            <span data-i18n="label_cpu_usage">Usage:</span> <span id="sysCPUUsage">--</span>
                            (Peak: <span id="sysCPUPeak">--</span>)
                        </div>
                    </div>
                    <div class="premium-card">
                        <div class="metric-label" data-i18n="label_memory_ram">Memory (RAM)</div>
                        <div id="sysRAMTotal" style="font-weight: bold; color: #333;">--</div>
                        <div style="margin-top: 5px; font-size: 0.9em; color: #666;">
                            <span data-i18n="label_used">Used:</span> <span id="sysRAMUsed">--</span>
                        </div>
                    </div>
                    <div class="premium-card">
                        <div class="metric-label" data-i18n="label_disk_io">Client Disk I/O</div>
                        <div style="display: flex; gap: 15px; margin-top: 5px;">
                            <div>
                                <div style="font-size: 0.8em; color: #666;" data-i18n="label_write">Write:</div>
                                <div id="diskWrite" style="font-weight: bold; color: #27ae60;">--</div>
                            </div>
                            <div>
                                <div style="font-size: 0.8em; color: #666;" data-i18n="label_read">Read:</div>
                                <div id="diskRead" style="font-weight: bold; color: #003d8f;">--</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Category 3: Reference Section -->
            <div class="dashboard-section">
                <h3 data-i18n="header_ref_speed"><i class="fas fa-globe"></i> Reference Speed (Speedtest.net)</h3>
                <div style="display: grid; gap: 15px;">
                    <!-- ISP Info - Full Width -->
                    <div class="premium-card">
                        <div class="metric-label" data-i18n="label_isp">Internet Service Provider</div>
                        <div style="font-weight: bold; color: #333;" id="resProvider">--</div>
                        <div style="font-size: 0.85em; color: #666; margin-top: 5px;" id="resStServer">--</div>
                    </div>
                    <!-- Upload & Download - Side by Side -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="premium-card" style="border-bottom: 3px solid #27ae60;">
                            <div class="metric-label" data-i18n="label_upload_ref">Upload (Ref)</div>
                            <div style="font-weight: bold; font-size: 1.2em; color: #27ae60;" id="refUp">--</div>
                        </div>
                        <div class="premium-card" style="border-bottom: 3px solid #003d8f;">
                            <div class="metric-label" data-i18n="label_download_ref">Download (Ref)</div>
                            <div style="font-weight: bold; font-size: 1.2em; color: #003d8f;" id="refDown">--</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Category 2: Performance Core -->
            <div class="dashboard-section">
                <h3 data-i18n="header_transfer_speed"><i class="fas fa-bolt"></i> Performance Core</h3>
                <div class="dashboard-grid perf-grid">
                    <!-- Small Files -->
                    <div class="premium-card perf-card">
                        <div class="metric-label" data-i18n="label_small_files">Small Files</div>
                        <div class="perf-metric">
                            <span data-i18n="label_upload">Upload:</span>
                            <span class="value" id="resSmall">--</span>
                            <div class="quality-indicator quality-none" id="qSmallUp"></div>
                            <span class="duration" id="durSmallUp">--</span>
                        </div>
                        <div class="perf-metric">
                            <span data-i18n="label_download">Download:</span>
                            <span class="value" id="resSmallDown">--</span>
                            <div class="quality-indicator quality-none" id="qSmallDown"></div>
                            <span class="duration" id="durSmallDown">--</span>
                        </div>
                        <div id="concSmall" class="conclusion-text"></div>
                    </div>

                    <!-- Medium Files -->
                    <div class="premium-card perf-card">
                        <div class="metric-label" data-i18n="label_medium_files">Medium Files</div>
                        <div class="perf-metric">
                            <span data-i18n="label_upload">Upload:</span>
                            <span class="value" id="resMedium">--</span>
                            <div class="quality-indicator quality-none" id="qMedUp"></div>
                            <span class="duration" id="durMedUp">--</span>
                        </div>
                        <div class="perf-metric">
                            <span data-i18n="label_download">Download:</span>
                            <span class="value" id="resMediumDown">--</span>
                            <div class="quality-indicator quality-none" id="qMedDown"></div>
                            <span class="duration" id="durMedDown">--</span>
                        </div>
                        <div id="concMed" class="conclusion-text"></div>
                    </div>

                    <!-- Large File -->
                    <div class="premium-card perf-card">
                        <div class="metric-label" data-i18n="label_large_file">Large File</div>
                        <div class="perf-metric">
                            <span data-i18n="label_upload">Upload:</span>
                            <span class="value" id="resLarge">--</span>
                            <div class="quality-indicator quality-none" id="qLargeUp"></div>
                            <span class="duration" id="durLargeUp">--</span>
                        </div>
                        <div class="perf-metric">
                            <span data-i18n="label_download">Download:</span>
                            <span class="value" id="resLargeDown">--</span>
                            <div class="quality-indicator quality-none" id="qLargeDown"></div>
                            <span class="duration" id="durLargeDown">--</span>
                        </div>
                        <div id="concLarge" class="conclusion-text"></div>
                    </div>
                </div>
            </div>

            <!-- Category 3: Connectivity & Health -->
            <div class="dashboard-section">
                <h3 data-i18n="header_network_summary"><i class="fas fa-network-wired"></i> Connectivity & Diagnostics
                </h3>
                <div class="dashboard-grid">
                    <!-- Network Health -->
                    <div class="premium-card">
                        <div class="metric-label">Network Health</div>
                        <div style="margin-top: 10px; display: grid; gap: 8px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span data-i18n="label_latency">Latency:</span>
                                <span><strong id="resPing">--</strong> <span class="quality-indicator quality-none"
                                        id="qPing"></span></span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span data-i18n="label_packet_loss">Packet Loss:</span>
                                <span><strong id="resPacketLoss">--</strong> <span
                                        class="quality-indicator quality-none" id="qLoss"></span></span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span data-i18n="label_dns">DNS Resolution:</span>
                                <strong id="resDNS">--</strong>
                            </div>
                        </div>
                    </div>
                    <!-- Local Access -->
                    <div class="premium-card">
                        <div class="metric-label" data-i18n="label_local_network">Local Access</div>
                        <div style="font-weight: bold; margin: 8px 0; color: #003d8f;" id="netConnType">--</div>
                        <div id="netInterfacesList" style="font-size: 0.85em;">
                        </div>
                    </div>
                    <!-- Advanced Stats -->
                    <div class="premium-card">
                        <div class="metric-label">Advanced Diagnostics</div>
                        <div id="advNetStats" style="margin-top: 10px; font-size: 0.9em; display: grid; gap: 5px;">
                            <div>SSL Handshake: <strong id="valSSL">--</strong></div>
                            <div>Path MTU: <strong id="valMTU">--</strong></div>
                            <div id="valVPN" style="color: #0082c9; font-weight: bold;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detailed Diagnostics Toggle -->
            <div style="margin: 20px 0;">
                <details>
                    <summary
                        style="cursor: pointer; color: #003d8f; font-weight: bold; text-align: center; padding: 10px; background: rgba(0,61,143,0.05); border-radius: 10px;"
                        data-i18n="section_network_diagnostics">
                        View Detailed Diagnostics (Ping, DNS, Traceroute)
                    </summary>
                    <div
                        style="padding: 20px; background: white; border-radius: 0 0 16px 16px; border: 1px solid #eee; border-top: none;">
                        <div class="dashboard-grid">
                            <div class="premium-card" style="background: #fff;">
                                <h4 data-i18n="label_tcp_connect">TCP Connect</h4>
                                <div style="font-size: 0.9em; margin-top: 10px;">
                                    <div style="display: flex; justify-content: space-between;"><span>Packets:</span>
                                        <strong id="pingCount">--</strong>
                                    </div>
                                    <div style="display: flex; justify-content: space-between;"><span>Avg:</span>
                                        <strong id="pingAvg">--</strong>
                                    </div>
                                    <div style="display: flex; justify-content: space-between;"><span>Min/Max:</span>
                                        <span><span id="pingMin">--</span> / <span id="pingMax">--</span></span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between;"><span>Loss:</span>
                                        <strong id="pingLoss">--</strong>
                                    </div>
                                </div>
                            </div>
                            <div class="premium-card" style="background: #fff;">
                                <h4 data-i18n="label_dns">DNS IPs</h4>
                                <div style="font-size: 0.9em; margin-top: 10px;">
                                    <div style="display: flex; justify-content: space-between;"><span>Time:</span>
                                        <strong id="dnsTime">--</strong>
                                    </div>
                                </div>
                                <div id="dnsIPs"
                                    style="font-family: monospace; font-size: 0.8em; margin-top: 10px; max-height: 80px; overflow-y: auto;">
                                </div>
                            </div>
                        </div>
                        <div class="premium-card" style="margin-top: 15px; background: #fff;">
                            <h4 style="margin-bottom: 10px;">Traceroute Path</h4>
                            <div id="tracerouteBox" class="log-output" style="max-height: 150px; font-size: 0.8em;">
                            </div>
                        </div>
                    </div>
                </details>
            </div>


            <!-- Action Buttons -->
            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
                <a href="/report/download" target="_blank" class="btn-primary"
                    style="flex: 1; text-decoration: none; padding: 18px; display: inline-flex; align-items: center; justify-content: center; gap: 10px;">
                    <i class="fas fa-file-download"></i> <span data-i18n="btn_download_report">Download Report</span>
                </a>
                <button class="btn-secondary" onclick="location.reload()"
                    style="background: #e0e7ff; color: #003d8f; border: none; padding: 18px; border-radius: 12px; cursor: pointer; font-weight: bold; flex: 0.5;">
                    <i class="fas fa-redo"></i> <span data-i18n="btn_run_new">Restart</span>
                </button>
            </div>
        </div>
    </div>

    <script src="/static/i18n.js"></script>
    <script src="/static/app.js"></script>
</body>

</html>