<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nextcloud Performance Tool</title>
    <link rel="icon" type="image/png" href="/static/favicon.png">
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <div class="container">
        <header>
            <div class="lang-toggle" onclick="toggleLanguage()">
                <i class="fas fa-globe"></i> <span id="currentLang">EN</span>
            </div>
            <h1><i class="fas fa-cloud"></i> <span data-i18n="title">Nextcloud Performance Check</span></h1>
            <div class="subtitle" data-i18n="subtitle">System & Network Analysis Tool</div>
        </header>

        <!-- Login Card -->
        <div class="card" id="loginCard">
            <h2><i class="fas fa-sign-in-alt"></i> <span data-i18n="connection_details">Connection Details</span></h2>
            <form onsubmit="event.preventDefault(); startTest();">
                <div class="form-group">
                    <label for="url" data-i18n="label_url">Nextcloud URL</label>
                    <input type="text" id="url" placeholder="https://cloud.example.com" value="https://">
                </div>
                <div class="form-group">
                    <label for="user" data-i18n="label_username">Username</label>
                    <input type="text" id="user" data-i18n-placeholder="placeholder_username"
                        placeholder="Your Username">
                </div>
                <div class="form-group">
                    <label for="pass" data-i18n="label_password">Password / App Token</label>
                    <input type="password" id="pass" data-i18n-placeholder="placeholder_password"
                        placeholder="Your Password">
                </div>
                <button type="submit" class="btn-primary">
                    <i class="fas fa-tachometer-alt"></i> <span data-i18n="btn_start">Start Benchmark</span>
                </button>
            </form>
        </div>

        <!-- Testing UI -->
        <div class="card" id="progressCard" style="display: none;">
            <h2><i class="fas fa-running"></i> <span data-i18n="test_running">Test in Progress</span></h2>

            <!-- Stage Indicators -->
            <div class="progress-stages">
                <div class="stage" id="stage-system"><i class="fas fa-desktop"></i> <span
                        data-i18n="stage_system">System</span></div>
                <div class="stage" id="stage-network"><i class="fas fa-network-wired"></i> <span
                        data-i18n="stage_network">Network</span></div>
                <div class="stage" id="stage-connect"><i class="fas fa-plug"></i> <span
                        data-i18n="stage_connect">Connect</span></div>
                <div class="stage" id="stage-benchmark"><i class="fas fa-tachometer-alt"></i> <span
                        data-i18n="stage_benchmark">Benchmark</span></div>
                <div class="stage" id="stage-report"><i class="fas fa-file-alt"></i> <span
                        data-i18n="stage_report">Report</span></div>
            </div>

            <!-- Current Status -->
            <div class="current-status">
                <div class="spinner"></div>
                <span id="currentStatus" data-i18n="status_initializing">Initializing...</span>
            </div>

            <!-- Progress Bar -->
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar" style="width: 0%">0%</div>
            </div>

            <div style="text-align: right; margin-bottom: 10px;">
                <button id="cancelBtn" class="btn-secondary" onclick="cancelTest()"
                    style="background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; padding: 8px 15px; font-size: 0.9em;">
                    <i class="fas fa-times-circle"></i> <span data-i18n="btn_cancel">Cancel Test</span>
                </button>
            </div>

            <!-- Log Output -->
            <div class="log-output" id="log"></div>
        </div>

        <!-- Results Card -->
        <div class="card" id="resultsCard" style="display: none;">
            <div id="resultHeader"
                style="background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); color: white; padding: 30px; border-radius: 12px; text-align: center; margin-bottom: 25px;">
                <i class="fas fa-check-circle" style="font-size: 50px; margin-bottom: 15px;"></i>
                <h2 style="margin: 0;" data-i18n="benchmark_completed">Benchmark Completed!</h2>
            </div>

            <h3 style="margin-bottom: 15px;"><i class="fas fa-desktop"></i> <span data-i18n="section_system_info">System
                    Information</span></h3>
            <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-bottom: 25px;">
                <div class="card" style="padding: 15px;">
                    <div style="font-size: 0.8em; color: gray;" data-i18n="label_client_os">Client OS</div>
                    <div style="font-weight: bold;" id="sysOS">--</div>
                    <div style="font-size: 0.8em; color: gray; margin-top: 5px;" data-i18n="label_cpu_model">CPU Model
                    </div>
                    <div style="font-size: 0.9em;" id="sysCPU">--</div>
                    <div style="font-size: 0.9em;"><span data-i18n="label_cpu_usage">CPU Usage:</span> <span
                            id="sysCPUUsage">--</span> (Peak: <span id="sysCPUPeak">--</span>)</div>
                    <div id="ncStatus"
                        style="margin-top: 10px; font-size: 0.85em; background: #e8f4fd; padding: 10px; border-radius: 5px; color: #003d8f; font-weight: bold; display: none;">
                    </div>
                </div>
                <div class="card" style="padding: 15px;">
                    <div style="font-size: 0.8em; color: gray;" data-i18n="label_disk_io">Client Disk I/O</div>
                    <div><span data-i18n="label_write">Write:</span> <span id="diskWrite">--</span></div>
                    <div><span data-i18n="label_read">Read:</span> <span id="diskRead">--</span></div>
                </div>
                <div class="card" style="padding: 15px;">
                    <div style="font-size: 0.8em; color: gray;" data-i18n="label_memory_ram">Memory (RAM)</div>
                    <div><span data-i18n="label_total">Total:</span> <span id="sysRAMTotal">--</span></div>
                    <div><span data-i18n="label_used">Used:</span> <span id="sysRAMUsed">--</span></div>
                    <div><span data-i18n="label_free">Free:</span> <span id="sysRAMFree">--</span></div>
                </div>
                <div class="card" style="padding: 15px;">
                    <div style="font-size: 0.8em; color: gray;" data-i18n="label_local_network">Local Network</div>
                    <div style="font-weight: bold; font-size: 1.1em;" id="netConnType">--</div>
                    <div style="margin-top:5px; font-size: 0.9em;">
                        <span data-i18n="label_primary_if">Primary Interface:</span> <span id="netPrimaryIF">--</span>
                    </div>
                    <div id="netInterfacesList" style="margin-top: 10px; border-top: 1px solid #eee; padding-top: 5px;">
                        <!-- Dynamically populated by app.js -->
                    </div>
                    <div id="advNetStats"
                        style="margin-top:10px; font-size: 0.85em; background: #f8f9fa; padding: 10px; border-radius: 5px; display: none;">
                        <div>SSL Handshake: <span id="valSSL">--</span></div>
                        <div>MTU: <span id="valMTU">--</span></div>
                        <div id="valVPN" style="color: #0082c9; font-weight: bold;"></div>
                    </div>
                </div>
            </div>

            <h3 style="margin-bottom: 15px;"><i class="fas fa-globe"></i> <span data-i18n="header_ref_speed">Reference
                    Speed (Speedtest.net)</span></h3>
            <div class="card"
                style="background: #f0f4ff; border-color: #d1dbff; text-align: center; margin-bottom: 20px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div>
                        <div class="metric-label" style="font-weight: bold;" data-i18n="label_isp">Internet Service
                            Provider</div>
                        <div class="metric-value" style="font-size: 1.1em;" id="resProvider">--</div>
                    </div>
                    <div>
                        <div class="metric-label" style="font-weight: bold;" data-i18n="label_server">Benchmark Server
                        </div>
                        <div class="metric-value" style="font-size: 1.1em;" id="resStServer">--</div>
                    </div>
                </div>
            </div>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 25px;">
                <div
                    style="background: #f0fdf4; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #bbf7d0;">
                    <div style="font-size: 0.85em; color: #166534;" data-i18n="label_upload_ref">Upload (Ref)</div>
                    <div style="font-size: 1.4em; font-weight: bold; color: #166534;" id="refUp">--</div>
                </div>
                <div
                    style="background: #fff5f5; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #ffcccc;">
                    <div style="font-size: 0.85em; color: #cc0000;" data-i18n="label_download_ref">Download (Ref)</div>
                    <div style="font-size: 1.4em; font-weight: bold; color: #cc0000;" id="refDown">--</div>
                </div>
            </div>

            <h3 style="margin-bottom: 15px;"><i class="fas fa-tachometer-alt"></i> <span
                    data-i18n="header_transfer_speed">Transfer Speed Results</span></h3>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 25px;">
                <div
                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; text-align: center;">
                    <div style="font-size: 0.85em; opacity: 0.9; margin-bottom: 5px;" data-i18n="label_small_files">
                        Small Files</div>
                    <div style="font-size: 0.7em; opacity: 0.7;">5 x 512KB</div>
                    <div style="margin-top: 10px;">
                        <span style="font-size: 0.8em; opacity: 0.8;" data-i18n="label_upload">Upload:</span>
                        <span style="font-size: 1.2em; font-weight: bold;" id="resSmall">--</span>
                        <span id="durSmallUp" style="font-size: 0.75em; opacity: 0.7; margin-left: 5px;"></span>
                        <span class="quality-indicator quality-none" id="qSmallUp"></span>
                    </div>
                    <div style="margin-top: 5px;">
                        <span style="font-size: 0.8em; opacity: 0.8;" data-i18n="label_download">Download:</span>
                        <span style="font-size: 1.2em; font-weight: bold;" id="resSmallDown">--</span>
                        <span id="durSmallDown" style="font-size: 0.75em; opacity: 0.7; margin-left: 5px;"></span>
                        <span class="quality-indicator quality-none" id="qSmallDown"></span>
                    </div>
                    <div class="conclusion-text" id="concSmall"></div>
                </div>
                <div
                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; text-align: center;">
                    <div style="font-size: 0.85em; opacity: 0.9; margin-bottom: 5px;" data-i18n="label_medium_files">
                        Medium Files</div>
                    <div style="font-size: 0.7em; opacity: 0.7;">3 x 5MB</div>
                    <div style="margin-top: 10px;">
                        <span style="font-size: 0.8em; opacity: 0.8;" data-i18n="label_upload">Upload:</span>
                        <span style="font-size: 1.2em; font-weight: bold;" id="resMedium">--</span>
                        <span id="durMedUp" style="font-size: 0.75em; opacity: 0.7; margin-left: 5px;"></span>
                        <span class="quality-indicator quality-none" id="qMedUp"></span>
                    </div>
                    <div style="margin-top: 5px;">
                        <span style="font-size: 0.8em; opacity: 0.8;" data-i18n="label_download">Download:</span>
                        <span style="font-size: 1.2em; font-weight: bold;" id="resMediumDown">--</span>
                        <span id="durMedDown" style="font-size: 0.75em; opacity: 0.7; margin-left: 5px;"></span>
                        <span class="quality-indicator quality-none" id="qMedDown"></span>
                    </div>
                    <div class="conclusion-text" id="concMed"></div>
                </div>
                <div
                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; text-align: center;">
                    <div style="font-size: 0.85em; opacity: 0.9; margin-bottom: 5px;" data-i18n="label_large_file">Large
                        File</div>
                    <div style="font-size: 0.7em; opacity: 0.7;">256MB (25MB Chunks)</div>
                    <div style="margin-top: 10px;">
                        <span style="font-size: 0.8em; opacity: 0.8;" data-i18n="label_upload">Upload:</span>
                        <span style="font-size: 1.2em; font-weight: bold;" id="resLarge">--</span>
                        <span id="durLargeUp" style="font-size: 0.75em; opacity: 0.7; margin-left: 5px;"></span>
                        <span class="quality-indicator quality-none" id="qLargeUp"></span>
                    </div>
                    <div style="margin-top: 5px;">
                        <span style="font-size: 0.8em; opacity: 0.8;" data-i18n="label_download">Download:</span>
                        <span style="font-size: 1.2em; font-weight: bold;" id="resLargeDown">--</span>
                        <span id="durLargeDown" style="font-size: 0.75em; opacity: 0.7; margin-left: 5px;"></span>
                        <span class="quality-indicator quality-none" id="qLargeDown"></span>
                    </div>
                    <div class="conclusion-text" id="concLarge"></div>
                </div>
            </div>

            <h3 style="margin-bottom: 15px;"><i class="fas fa-network-wired"></i> <span
                    data-i18n="header_network_summary">Network Summary</span></h3>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 25px;">
                <div class="card">
                    <div style="font-size: 0.85em; opacity: 0.8;" data-i18n="label_latency">Avg Latency</div>
                    <div class="metric-value">
                        <span id="resPing">--</span>
                        <span class="quality-indicator quality-none" id="qPing"></span>
                    </div>
                </div>
                <div class="card">
                    <div style="font-size: 0.85em; opacity: 0.8;" data-i18n="label_packet_loss">Packet Loss</div>
                    <div class="metric-value">
                        <span id="resPacketLoss">--</span>
                        <span class="quality-indicator quality-none" id="qLoss"></span>
                    </div>
                </div>
                <div class="card">
                    <div style="font-size: 0.85em; opacity: 0.8;" data-i18n="label_dns">DNS Resolution</div>
                    <div class="metric-value">
                        <span id="resDNS">--</span>
                    </div>
                </div>
            </div>

            <!-- Detailed Ping Statistics Card -->
            <div style="display: grid; grid-template-columns: 1fr; gap: 15px; margin-bottom: 25px;">
                <div class="card">
                    <div class="metric-label"><span data-i18n="label_tcp_connect">TCP Connect</span> (<span
                            id="pingCount">--</span> packets)</div>
                    <div class="metric-value"><span data-i18n="label_avg">Avg:</span> <span id="pingAvg">--</span></div>
                    <div class="metric-label"><span data-i18n="label_min">Min:</span> <span id="pingMin">--</span> |
                        <span data-i18n="label_max">Max:</span> <span id="pingMax">--</span>
                    </div>
                    <div class="metric-label"><span data-i18n="label_packet_loss">Packet Loss:</span> <span
                            id="pingLoss">--</span></div>
                </div>
            </div>

            <!-- Detailed Network Diagnostics -->
            <div style="margin-top: 30px; margin-bottom: 25px;">
                <details>
                    <summary style="cursor:pointer; color: #003d8f; font-weight:bold; margin-bottom: 10px;"
                        data-i18n="summary_view_ping">View Detailed Ping Results</summary>
                    <table style="width: 100%; border-collapse: collapse; font-size: 0.9em;">
                        <thead>
                            <tr style="background: #f2f2f2;">
                                <th style="padding:5px; border:1px solid #ddd;" data-i18n="th_seq">Seq</th>
                                <th style="padding:5px; border:1px solid #ddd;" data-i18n="th_time">Time (ms)</th>
                                <th style="padding:5px; border:1px solid #ddd;" data-i18n="th_status">Status</th>
                            </tr>
                        </thead>
                        <tbody id="pingTableBody">
                        </tbody>
                    </table>
                </details>
            </div>

            <div style="margin-bottom: 25px;">
                <h4>DNS & Traceroute</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="card">
                        <div class="metric-label" data-i18n="label_dns">DNS Resolution</div>
                        <div id="dnsTime" style="font-size: 1.1em; font-weight: bold; margin-bottom: 5px;">--</div>
                        <div id="dnsIPs"
                            style="font-size: 0.85em; max-height: 150px; overflow-y: auto; font-family: monospace;">-
                        </div>
                    </div>
                    <div id="tracerouteBox" class="log-output"
                        style="background: #2d2d2d; color: #00ff00; padding: 15px; border-radius: 8px; font-size: 0.8em; max-height: 200px; margin-top:0;">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <a href="/report/download" target="_blank" class="btn-primary"
                    style="display: inline-block; text-decoration: none; padding: 18px 50px; font-size: 1.1em;">
                    <i class="fas fa-file-download"></i> <span data-i18n="btn_download_report">Download Detailed
                        Report</span>
                </a>
            </div>

            <div style="margin-top: 20px; text-align: center;">
                <button class="btn-secondary" onclick="location.reload()" style="padding: 12px 30px;">
                    <i class="fas fa-redo"></i> <span data-i18n="btn_run_new">Run New Test</span>
                </button>
            </div>
        </div>
    </div>

    <script src="/static/i18n.js"></script>
    <script src="/static/app.js"></script>
</body>

</html>